<div class="dashboard360 container">

  <!-- HEADER -->
  <header class="header-row">
    <h1>ğŸ’ª SmartFit â€” Tableau de Bord 360Â°</h1>
    <button class="refresh-btn" (click)="refreshAll()">ğŸ”„ RafraÃ®chir</button>
  </header>

  <!-- STATISTIQUES PRINCIPALES -->
  <section class="stats-summary-grid">
    <div class="stat-card modern-card">
      <div class="stat-icon">ğŸ‘¥</div>
      <div>
        <div class="stat-title">Membres actifs</div>
        <div class="stat-value">{{ clients?.length || 0 }}</div>
      </div>
    </div>

    <div class="stat-card modern-card">
      <div class="stat-icon">ğŸ“ˆ</div>
      <div>
        <div class="stat-title">Progression moyenne</div>
        <div class="stat-value">{{ averageProgression | number: '1.1-1' }}%</div>
      </div>
    </div>

    <div class="stat-card modern-card">
      <div class="stat-icon">âš™ï¸</div>
      <div>
        <div class="stat-title">Recommandations</div>
        <div class="stat-value">
          {{ loadingRecommendations ? 'â³ En cours' : 'âœ… PrÃªtes' }}
        </div>
      </div>
    </div>
  </section>

  <!-- GRAPHIQUE DE PROGRESSION -->
  <section class="chart-section">
    <h2>ğŸ“Š Progression des membres</h2>
    <canvas id="progressChart"></canvas>
  </section>

  <!-- SUIVI PERSONNALISÃ‰ -->
  <section class="members-section">
    <h2>ğŸ‹ï¸ Suivi des membres</h2>

    <div *ngIf="loading" class="note">Chargement...</div>
    <div *ngIf="!loading && (!clients || clients.length === 0)" class="note">
      Aucun membre trouvÃ©.
    </div>

    <div *ngFor="let c of clients" class="member-card">
      <div class="member-top">
        <div>
          <div class="member-name">{{ c.nom }}</div>
          <div class="member-meta">
            {{ c.age ? c.age + ' ans' : 'Ã‚ge non dÃ©fini' }} â€¢ {{ c.objectif || 'Aucun objectif' }}
          </div>
        </div>
        <div class="member-actions">
          <button (click)="toggleTraining(c)">ğŸ‹ï¸ Programme</button>
          <button (click)="toggleDiet(c)">ğŸ¥— RÃ©gime</button>
        </div>
      </div>

      <div class="progress-wrap">
        <div class="progress-bar-bg">
          <div class="progress-bar-fill" [style.width.%]="(c.progression_estimee ?? 0) * 100"></div>
        </div>
        <div class="progress-text">
          {{ ((c.progression_estimee ?? 0) * 100) | number: '1.1-1' }}%
        </div>
      </div>

      <!-- PROGRAMME Dâ€™ENTRAÃNEMENT -->
      <div *ngIf="c.showTraining" class="details">
        <h5>ğŸ‹ï¸ Programme d'entraÃ®nement</h5>
        <p><strong>DurÃ©e totale par semaine :</strong> {{ getTrainingFor(c.nom)?.duree_semaine || 0 }} min</p>
        <p><strong>Niveau :</strong> {{ getTrainingFor(c.nom)?.niveau || 'Non dÃ©fini' }}</p>
        <ul>
          <li *ngFor="let ex of getTrainingFor(c.nom)?.exercices">{{ ex }}</li>
        </ul>
      </div>

      <!-- PLAN ALIMENTAIRE -->
      <div *ngIf="c.showDiet" class="details">
        <h5>ğŸ¥— Plan alimentaire</h5>
        <p><strong>Calories totales :</strong> {{ getDietFor(c.nom)?.calories_totales || 0 }}</p>
        <div *ngFor="let repas of getDietFor(c.nom)?.repas">
          <p><strong>{{ repas.nom }}</strong></p>
          <ul>
            <li *ngFor="let aliment of repas.aliments">{{ aliment }}</li>
          </ul>
        </div>
      </div>

    </div>
  </section>

  <!-- SUPPORT DÃ‰CISIONNEL -->
  <section class="decision-section">
    <h2 class="section-title">ğŸ¤– Support dÃ©cisionnel intelligent</h2>

    <div class="decision-grid">
      <!-- FidÃ©litÃ© -->
      <div class="decision-card fidelity-card">
        <div class="card-header">
          <div class="icon">ğŸ¤</div>
          <h4>FidÃ©litÃ©</h4>
        </div>
        <div class="card-body">
          <div *ngIf="decisionSupport.actions_fidelite.length; else noFidelite">
            <div
              *ngFor="let action of decisionSupport.actions_fidelite"
              class="action-card"
            >
              <p>{{ action }}</p>
            </div>
          </div>
          <ng-template #noFidelite>
            <div class="empty-message">Aucune action suggÃ©rÃ©e.</div>
          </ng-template>
        </div>
      </div>

      <!-- SantÃ© -->
      <div class="decision-card health-card">
        <div class="card-header">
          <div class="icon">ğŸ’–</div>
          <h4>SantÃ©</h4>
        </div>
        <div class="card-body">
          <div *ngIf="decisionSupport.actions_sante.length; else noSante">
            <div
              *ngFor="let action of decisionSupport.actions_sante"
              class="action-card"
            >
              <p>{{ action }}</p>
            </div>
          </div>
          <ng-template #noSante>
            <div class="empty-message">Aucune action suggÃ©rÃ©e.</div>
          </ng-template>
        </div>
      </div>

      <!-- RentabilitÃ© -->
      <div class="decision-card profit-card">
        <div class="card-header">
          <div class="icon">ğŸ’°</div>
          <h4>RentabilitÃ©</h4>
        </div>
        <div class="card-body">
          <div *ngIf="decisionSupport.actions_rentabilite.length; else noRentabilite">
            <div
              *ngFor="let action of decisionSupport.actions_rentabilite"
              class="action-card"
            >
              <p>{{ action }}</p>
            </div>
          </div>
          <ng-template #noRentabilite>
            <div class="empty-message">Aucune action suggÃ©rÃ©e.</div>
          </ng-template>
        </div>
      </div>
    </div>
  </section>

</div>
